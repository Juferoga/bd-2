<div class="section-title">
  <h1>Usuarios registrados</h1>
</div>
<div class="card">
  <p-toolbar>
    <ng-template pTemplate="left">
      <button style="margin: 10px" pButton pRipple label="Crear" icon="pi pi-plus" class="p-button-success" (click)="openNew()"
      ></button>
      <button pButton pRipple [label]="Delete" icon="pi pi-trash" class="p-button-danger" (click)="deleteSelectedUsers()" [disabled]="!selectedUsers || !selectedUsers.length"
      ></button>
    </ng-template>

    <ng-template pTemplate="right">
      <p-fileUpload style="margin: 10px; display: inline-block" mode="basic" accept="image/*" [maxFileSize]="1000000" label="Importar" chooseLabel="Importar"
      ></p-fileUpload>
      <button pButton pRipple label="Exportar" icon="pi pi-upload" class="p-button-help"
      ></button>
    </ng-template>
  </p-toolbar>

  <p-table
    #dt [value]="usersList" [rows]="10" [paginator]="true"
		[globalFilterFields]="[
      'name',
      'country.name',
      'representative.name',
      'status'
    ]" [tableStyle]="{ 'min-width': '75rem' }" [(selection)]="selectedUsers" [rowHover]="true" 
		dataKey="id" currentPageReportTemplate="Mostrando {first} al {last} de {totalRecords} entradas" 
		[showCurrentPageReport]="true"
  >
    <ng-template pTemplate="caption">
      <div class="caption">
        <h5 style="margin: 0">Administrar usuarios</h5>
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <!-- TODO: Averiguar porque no sirve :) -->
          <input
            pInputText
            type="text"
            (input)="dt.filterGlobal($event.target, 'contains')"
            placeholder="Buscar..."
          />
        </span>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th pSortableColumn="k_usuario" style="min-width: 15rem">
          Usuario <p-sortIcon field="k_usuario"></p-sortIcon>
        </th>
        <th>Imagen</th>
        <th pSortableColumn="t_nombre">
          Nombre <p-sortIcon field="t_nombre"></p-sortIcon>
        </th>
        <th pSortableColumn="n_telefono" style="min-width: 10rem">
          Telefono <p-sortIcon field="n_telefono"></p-sortIcon>
        </th>
        <th pSortableColumn="t_direccion">
          Dirección <p-sortIcon field="t_direccion"></p-sortIcon>
        </th>
        <th pSortableColumn="t_email" style="min-width: 10rem">
          Correo <p-sortIcon field="t_email"></p-sortIcon>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>
          <p-tableCheckbox [value]="user"></p-tableCheckbox>
        </td>
        <td>{{ user.name }}</td>
        <td>
          <img [src]="'https://primefaces.org/cdn/primeng/images/demo/product/' + user.image"
            [alt]="user.name" width="100" class="img-shadow"
          />
        </td>
        <td>{{ user.price | currency : "USD" }}</td>
        <td>{{ user.category }}</td>
        <td>
          <p-rating [ngModel]="user.rating" [readonly]="true" [cancel]="false"
          ></p-rating>
        </td>
        <td>
          <span
            [class]="
              'user-badge status-' +
              (user.inventoryStatus
                ? user.inventoryStatus.toLowerCase()
                : '')
            "
            >{{ user.inventoryStatus }}</span
          >
        </td>
        <td>
          <button pButton pRipple icon="pi pi-pencil" style="margin-right: 2px" class="p-button-rounded p-button-success" (click)="editUser(user)"
          ></button>
          <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning" (click)="deleteUser(user)"
          ></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="summary">
      <div class="caption">
        En total hay {{ usersList ? usersList.length : 0 }} usuarios.
      </div>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="userDialog" [style]="{ width: '450px' }" header="Usuario nuevo" [modal]="true" styleClass="p-fluid" >
  <ng-template pTemplate="content">
    <img [src]="'https://primefaces.org/cdn/primeng/images/demo/product/' + user.image"
			[alt]="user.image" class="user-image" *ngIf="user.image"
    />
		<form [formGroup]="userForm">
			<div class="row align-items-end justify-content-center">
				<div class="">
					<label for="name">Usuario</label>
					<input type="text" pInputText id="name" formControlName="k_usuario" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Nombre</label>
					<input type="text" pInputText id="name" formControlName="t_nombre" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Apellido</label>
					<input type="text" pInputText id="name" formControlName="t_apellido" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Fecha nacimiento</label>
					<input type="date" pInputText id="name" formControlName="f_nacimiento" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Genero</label>
					<input type="text" pInputText id="name" formControlName="i_genero" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Telefono</label>
					<input type="text" pInputText id="name" formControlName="n_telefono" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Dirección</label>
					<input type="text" pInputText id="name" formControlName="t_direccion" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Correo</label>
					<input type="text" pInputText id="name" formControlName="t_email" required autofocus/>
				</div>
				<!--  -->
				<div class="">
					<label for="name">Estado</label>
					<p-dropdown [options]="statuses" [(ngModel)]="estado" optionLabel="Estado">
						<ng-template let-option pTemplate="item">
							<span [class]="'product-badge status-' + option.value">{{
								option.label
							}}</span>
						</ng-template>
					</p-dropdown>
					<!-- <select name="cars" id="input-control">
						<option selected value="1">Activo</option>
						<option value="0">Inactivo</option>
					</select> -->
				</div>
				<div class="field" style="margin: 10px">
					<label for="inventoryStatus">Estado del usuario</label>
					<p-dropdown formControlName="i_estado" inputId="inventoryStatus" [options]="statuses" placeholder="Select">
						<ng-template let-option pTemplate="item">
							<span [class]="'user-badge status-' + option.value">{{
								option.label
							}}</span>
						</ng-template>
					</p-dropdown>
				</div>
			</div>
		</form>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()" ></button>
    <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveUser()" ></button>
  </ng-template>
</p-dialog>
