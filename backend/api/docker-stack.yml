version: '3.1'

services:
  backend:
    image: juferoga/bd2-back:1.0
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    networks:
      - proxy
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
      placement:
        constraints: [node.hostname==juferoga.live]    
      labels:
        - "traefik.enable=true"
        - "traefik.docker.network=proxy"
        - "traefik.port=8000"
        - "traefik.http.routers.api-secure.entrypoints=websecure"
        - "traefik.http.routers.api-secure.rule=Host(`bd-back.juferoga.live`)"
networks:
      proxy:
        external: true